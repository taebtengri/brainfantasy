<!DOCTYPE html>
<html>
<head>
	<title>Brain Ring Fantasy</title>
		<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"> -->
	  	<script src="https://code.jquery.com/jquery.js"></script>
	  	<!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script> -->
	  	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
		<link rel="stylesheet" href="style.css">
		<link rel="stylesheet" href="/public/style.css">

</head>
<body>
<div class="container">
	<div class="row">
		<div class="col-md-9">
			<h1 class="fifty">Breyn Rinq Fantasy!</h1>
			<h2>Transferlər</h2>
			
		</div>
		<div class="col-md-2">
			<h3 id="salam">Salam, <a href="#">username</a>!</h3>
		</div>
	</div>
	<div class="row">
		<div class="col-md-6">
			<div class="btn-toolbar plashka" role="toolbar" aria-label="Toolbar with button groups">
			  
			    <button type="button" class="btn btn-primary" onclick="window.location.href='/'">Ana səhifə
			    </button>
			    <button type="button" class="btn btn-primary" onclick="window.location.href='/transfer'">Transferlər</button>
			    <button type="button" class="btn btn-primary" onclick="window.location.href='/rating'">Reytinq</button>
			    <button type="button" class="btn btn-primary" onclick="window.location.href='/signout'">Çıxış</button>
			  
			</div>
		</div>
		
	</div>
	<div class="row">
		<div class="col-md-12">
			<h3>Transfer sezonu açıqdır. Bağlanışa <span id="transferTime"></span> qalıb</h3>
		</div>
			
		</div>
	<div class="row">
		<div class="col-lg-5 r">
			<h2>Transfer pulunuz: <span id="pul"></span> </h2><br>
			<h2>Komandanız:</h2>
			<div id="koman">
			<div class="komanda">

			
				
				
			
			</div>
			</div>
			<button class="btn-primary qeyd">Qeyd et</button>
			<button class="btn-danger udalit">Sil</button>	

		</div>
		<div class="col-lg-6 r">
			<h2>Oyunçular:</h2>
			<div id="oyuncular">
			<table class="table table-inverse" id="table">
			<thead>
	          <tr>
	                  <th>Oyunçu</th>
	                  <th>Komanda</th>
	                  <th>Xallar</th>
	                  <th>Transfer qiyməti</th>
	                  <th></th>
	          </tr>
	          </thead>
	          <tbody>
          	  <tr class="results"></tr></tbody>
             
              
            
          </table>
				
			</div>
		</div>
	</div>
	
</div>



</body>
<script type="text/javascript">

	function handledata(data) {
	 $(".results").html(" ");
		 console.log(data);
        for (var i = 0; i < data.length; i++) {
        var wellSection = $("<tr class='results'>");
        wellSection.addClass("well");
        wellSection.attr("id", "c" + i);
        $("table").append(wellSection);

        $("#c" + i).append("<th class='imya'>" + data[i].name + "</th>");
        $("#c" + i).append("<th>" + data[i].team + "</th>");
        $("#c" + i).append("<th>" + data[i].score + "</th>");
        $("#c" + i).append("<th id='cena" + i +"'>" + data[i].price + "</th>")
        $("#c" + i).append("<th><button type='button' class='btn btn-success dobavit' id='"+i+"'>+</button></th></tr>");
        setTimeout(saved, 1000);


      
	


       
        console.log("xexexexe");

      }
	}

	function saved(){
	  $.ajax({
	  url: "/saved",
	  type: 'GET'}).done(function(x) {
	  setTimeout(saved1(x), 2000);
		});
	};

	function saved1(x){
	for (i=0; i<6; i++) {
		$("#" + x.team[i]).trigger("click");
		};
		$("#i" + x.team[6]).children(".kapitan").trigger("click");
	};

	function populate() {
	$.ajax({
	url:"/players",
	type: 'GET'}).done(handledata)
        //event.preventDefault();
    }
    populate();
    // Set the date we're counting down to
var countDownDate = new Date("Sep 5, 2017 15:37:25").getTime();

// Update the count down every 1 second
var x = setInterval(function() {

    // Get todays date and time
    var now = new Date().getTime();
    
    // Find the distance between now an the count down date
    var distance = countDownDate - now;
    
    // Time calculations for days, hours, minutes and seconds
    var days = Math.floor(distance / (1000 * 60 * 60 * 24));
    var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    var seconds = Math.floor((distance % (1000 * 60)) / 1000);
    
    // Output the result in an element with id="demo"
    document.getElementById("transferTime").innerHTML = days + " gün " + hours + " saat "
    + minutes + " dəqiqə " + seconds + " saniyə ";
    
    // If the count down is over, write some text 
    if (distance < 0) {
        clearInterval(x);
        document.getElementById("transferTime").innerHTML = "EXPIRED";
    }
}, 1000);
/////////////////////////////////////////////////////////////////////////////////








var counter = 0;
var scounter = 0;
var kcounter = 0;

var team = [];
var steam = [];

$(document).on('click', 'button.dobavit', function () {
	var svyaz = $(this).attr('id');
	if (counter > 5) {
	alert("Komandanız doludur")
	}
	else {
    var player = $(this).parent().siblings();
    steam.push(player);
	
	var price = Number(player[3].innerText);

	if (pul - price < 0) {
	alert("Pulunuz çatmır")
	}
	else {


	 pul -= price;
	 $("#pul").text(pul);
     
     console.log(player);
	var divKomanda = $("<div class='komanda'>");
        divKomanda.attr("id", "i" + svyaz);
        $("#koman").append(divKomanda);


     $("#i" + svyaz).append("<div id='igrok" + scounter + "'></div>")
     $("#i" + svyaz).append(player[0].innerText + "<br>")
     $("#i" + svyaz).append("Komanda: " + player[1].innerText + "<br>")
     $("#i" + svyaz).append("Xallar: " + player[2].innerText + "<br>")
     $("#i" + svyaz).append("Transfer qiyməti: <span class='cena'>" + player[3].innerText + "</span><br>")
	 $("#i" + svyaz).append("<button type='button' class='btn btn-primary kapitan "+ svyaz +"'>Kapitan olsun</button><br>")
     $("#i" + svyaz).append("<button type='button' class='btn btn-danger sil "+ svyaz +"'>-</button><br><br>")

     
     $(this).prop("disabled", true)
     $(this).parent().siblings().css({"color": "red"});
     counter++
     scounter++
     console.log(team);

     if (kcounter !== 0) {
     $(".kapitan").prop("disabled", true);
     $(".kapitan").hide();
     }

     return false;
     }
     }

 });

 $(document).on('click', 'button.sil', function () {
 	$(this).removeClass( "btn btn-danger sil" );
 	var obrsvyaz = $(this).attr('class');
 	$("#"+obrsvyaz).prop("disabled", false);
 	$("#"+obrsvyaz).parent().siblings().css({"color": "white"});
 	counter--;
 	var cena = 	$(this).siblings(".cena");
 	console.log(cena);
 	var cena1 = Number(cena[0].innerText);
 	pul += cena1;
 	$("#pul").text(pul);
 	if($(this).parent().attr('id').indexOf("k") !== -1) {
 		$(".kapitan").prop("disabled", false);
 		kcounter = 0;
 		$(".kapitan").show();
 	}
 	$(this).parent().remove();

 })
  $(document).on('click', 'button.udalit', function () {
 	$("#koman").html("");
 	$(".dobavit").prop("disabled", false)
 	counter = 0;
 	pul = 100;
 	$("#pul").text(pul);
 	$(".dobavit").parent().siblings().css({"color": "white"});
 	kcounter = 0;

 })

 $(document).on('click', 'button.kapitan', function () {
 	kcounter++;
	$(".kapitan").prop("disabled", true);
	$(".kapitan").hide();
	$(this).parent().css({"color": "blue"});
	var kep = $(this).parent().attr('id');
	kep = "k" + kep
	$(this).parent().attr("id", kep);
	
 })


 var pul = 100;

 $("#pul").text(pul);

 var teamsend = [];

 $(".qeyd").click(function(){
 	if (counter < 5 || kcounter == 0) {
 		alert("Komandanız tənzimlənməyib! Komandada 6 nəfər olmalıdır və bir nəfər mütləq kapitan olmalıdır.");
 		return;
 	}
 	else {
 	var k = $("#koman").children();
 	var kkk;
 	console.log(k);
 	for (i=0; i<6; i++) {
 		var kk = k[i].id;
 		if (kk[0] == "k") {

 		
 		kk = kk.slice(2);
 		kk = Number(kk);
		kkk = kk

 		}

 		else {

 		kk = kk.slice(1);
 		kk = Number(kk);

 		}
 		
 		teamsend.push(kk);
 	}
 	teamsend.push(kkk);
 	console.log(team);
 	var parameters = {
 		team: teamsend
 	}
 	   $.post("/save", parameters)
      	.fail(function() {
    		alert( "error" );
  		})
        .done(function(data) {
			console.log(data);
			alert("Komandanız qeyd olundu!")
        });

 	}

 })







</script>
</html>